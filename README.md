# Что это
Небольшое Python-приложение, которое слушает аудиопоток с камеры домофона Fnet/Ufanet. Оно умеет распознавать различные типы звуков (нажатия кнопок, сигнал вызова) и, обнаружив заданную последовательность, отправляет веб-хук.

Я отправляю хук в hass, дверь открывает эта интеграция: https://github.com/Muxee4ka/ucams_home_assistant/

# Как использовать

### 1. Установка зависимостей
```bash
pip install -r requirements.txt
```

### 2. Настройка
Вся конфигурация осуществляется через `.env` файл. Создайте его в корне проекта.

Пример файла `.env`:
```ini
# --- Учетные данные от приложения Ufanet/Fnet ---
UFA_USER=""
UFA_PASS=""

# --- Активация детекторов (true/false) ---
# Включить распознавание нажатий кнопок
DETECT_BUTTONS=true
# Включить распознавание сигнала вызова
DETECT_CALL=true

# --- URL для веб-хуков ---
# Веб-хук для серии нажатий кнопок
WEBHOOK_URL_BUTTONS=""
# Веб-хук для звука звонка
WEBHOOK_URL_CALL=""
```

### 3. Запуск
```bash
python main.py
```
Можно тестировать работу на записанном файле:
```bash
python main.py /path/to/file.mp4
```

# Продвинутая настройка (Тюнинг детектора)

Если стандартные настройки распознавания (например, для кнопок) на вашем домофоне не работают, их можно изменить.
Процесс поиска правильных частот:

1.  Запишите звук нужного события (например, несколько нажатий кнопок) в файл: `python recorder.py`
2.  Вырежьте небольшой (0.02 - 0.03 секунды) образец чистого звука с помощью `ffmpeg`:
    `ffmpeg -i recording_...mp4 -ss 3.00 -t 0.03 -vn beep.wav` (где `ss` — время старта, `t` — длительность)
3.  Проанализируйте, на каких частотах есть пики: `python analyze_beep.py beep.wav`
4.  **Откройте `main.py`** и найдите словарь `SOUND_PROFILES`. Внутри него найдите профиль, который вы хотите изменить (например, `BUTTON_PRESS`), и скорректируйте его параметры:
    *   `target_frequencies`: укажите нужные частоты
    *   `energy_threshold_multiplier`: меньше значение — больше чувствительность
    *   `target_count`: длина серии сигналов, при которой сработает хук

# Развертывание в Docker

1.  Создайте `.env` файл с нужными настройками, как описано в разделе "Настройка".
2.  Запустите контейнер в фоновом режиме:
    ```bash
    docker compose up -d --build
    ```
